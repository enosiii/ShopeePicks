<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<title>Shopee Picks</title>
<link rel="icon" href="SP192.png" type="image/png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#007bff">
<script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #4361ee;
    --secondary: #3f37c9;
    --accent: #4895ef;
    --light: #f8f9fa;
    --dark: #212529;
    --success: #4cc9f0;
    --warning: #f72585;
    --gray: #6c757d;
    --light-gray: #e9ecef;
  }

  html, body {
    margin: 0;
    padding: 0;
    height: 100%; 
    width: 100%;
    overflow: hidden; 
  }

  body {
    display: flex;
    flex-direction: column;
  }

  iframe {
    flex-grow: 1;
    width: 100%;
    height: 100%; /* Ensure iframe fills available height */
    border: none;
  }

  .header {
    background-color: #f0f0f0;
    padding: 10px;
    text-align: center;
  }

  button {
    background-color: var(--primary);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 50px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    margin: 2rem auto 0;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
  }

  button i {
    margin-right: 10px;
  }

  button:hover {
    background-color: var(--secondary);
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(67, 97, 238, 0.4);
  }

  button:active {
    transform: translateY(0);
  }

  .install-container {
    text-align: center;
  }

  #installPWA {
    padding: 15px 30px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
    align-items: center;
    margin-top: 1rem;
    margin-bottom: 1rem;
  }

  #installPWA i {
    margin-right: 10px;
  }

  #installPWA:hover {
    background: var(--secondary);
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(67, 97, 238, 0.4);
  }

  #installPWA:active {
    transform: translateY(0);
  }
</style>
</head>
<body>

<div class="install-container">
  <button id="installPWA" style="display: none;">
    <i class="fas fa-download"></i> Add to Home Screen
  </button>
</div>

<iframe id="shopeeFrame" src="https://collshp.com/shopee_picks_sp" title="Shopee Picks SP"></iframe>

<script>
  let deferredPrompt;

  window.addEventListener('beforeinstallprompt', (event) => {
    event.preventDefault();
    deferredPrompt = event;
    document.getElementById('installPWA').style.display = 'inline-flex';
  });

  document.getElementById('installPWA').addEventListener('click', () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then((choiceResult) => {
        if (choiceResult.outcome === 'accepted') {
          console.log('User accepted PWA installation');
        } else {
          console.log('User dismissed PWA installation');
        }
        deferredPrompt = null;
      });
    }
  });

  window.addEventListener('appinstalled', () => {
    console.log('PWA installed');
    document.getElementById('installPWA').style.display = 'none';
  });

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js', { scope: '/' })
      .then((registration) => {
        console.log('Service Worker registered with scope:', registration.scope);
      })
      .catch((error) => {
        console.error('Service Worker registration failed:', error);
      });
  }

  // Add event listener to iframe load to try and capture clicks.
  document.getElementById('shopeeFrame').addEventListener('load', function(){
      document.getElementById('shopeeFrame').contentWindow.document.addEventListener('click', function(e){
          let target = e.target;
          while (target) {
              if (target.tagName === 'A') {
                  const href = target.getAttribute('href');
                  if (href && href.startsWith('https://')) {
                      window.location.href = href;
                      e.preventDefault();
                      break;
                  }
              }
              target = target.parentNode;
          }
      });
  });

</script>
</body>
</html>
